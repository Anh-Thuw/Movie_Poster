{% extends "base.html" %}

{% block title %}Movie Genre Recognition{% endblock %}

{% block content %}
<section class="categories spad" style="min-height: 300px; display: flex; align-items: center; color: white;">
    <div class="container text-center">
        <h1 class="display-4 fw-bold mb-3" style="color: white;">Movie Genre Recognition</h1>
        <p class="lead mb-4" style="color: white;">
            Use advanced artificial intelligence to quickly and accurately identify movie genres from images.
        </p>

        <button id="btnStart" class="btn btn-light btn-lg mb-4">Start Recognition</button>

        <form id="uploadForm" action="{{ url_for('views.categories') }}" method="POST" enctype="multipart/form-data">
            <input type="file" id="inputImage" name="image" accept="image/*" style="display: none;">

            <div id="detectionSection" class="row justify-content-center align-items-start mt-4"
                 style="display: {% if genre %}flex{% else %}none{% endif %};">
                <div class="col-md-6 mb-4">
                    <div id="preview" style="height: auto; border: 2px dashed rgba(255,255,255,0.5); border-radius: 8px;
                         display: flex; justify-content: center; align-items: center; flex-direction: column;
                         background-color: rgba(255,255,255,0.1); cursor: pointer; padding: 20px;">
                        <span id="preview-text" style="color: rgba(255,255,255,0.7); text-align: center;
                              {% if genre %}display: none;{% endif %}">Click here to select image</span>
                        <img id="preview-img"
                             src="{% if genre and image_url %}{{ image_url }}{% endif %}"
                             alt="" style="max-width: 100%; max-height: 250px; border-radius: 8px;
                             {% if genre %}display: block;{% else %}display: none;{% endif %}; margin-top: 10px;">
                    </div>
                    <p id="image-name" class="mt-2" style="color: #ccc; font-style: italic;">
                        {% if image_name %}Selected image: {{ image_name }}{% endif %}
                    </p>
                </div>

                <div class="col-md-4 mb-4 d-flex align-items-center justify-content-center" style="height: 320px;">
                    <button type="submit" id="btnDetect" class="btn {% if genre %}btn-secondary{% else %}btn-primary{% endif %} btn-lg w-100">
                        {% if genre %}
                            <i class="fas fa-redo me-2"></i>Detect Again
                        {% else %}
                            <i class="fas fa-magnifying-glass me-2"></i>Detect Now
                        {% endif %}
                    </button>
                </div>
            </div>

            {% if genre %}
            <div id="result" class="mt-4">
                <h4 style="color: #00e676;">
                    Movie Genre: <span id="genre-result">{{ genre }}</span>
                </h4>
            </div>
            {% endif %}
        </form>
    </div>
</section>

<!-- Font Awesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

<script>
    const btnStart = document.getElementById('btnStart');
    const inputImage = document.getElementById('inputImage');
    const preview = document.getElementById('preview');
    const previewImg = document.getElementById('preview-img');
    const previewText = document.getElementById('preview-text');
    const detectionSection = document.getElementById('detectionSection');
    const imageName = document.getElementById('image-name');

    // Khi nhấn Start mới hiện khung chọn ảnh và nút Detect
    btnStart?.addEventListener('click', () => {
        detectionSection.style.display = 'flex';
        btnStart.style.display = 'none';
    });

    // Chỉ khi click vào khung preview mới hiện hộp chọn ảnh
    preview?.addEventListener('click', () => inputImage.click());

    // Khi người dùng chọn ảnh
    inputImage?.addEventListener('change', () => {
        const file = inputImage.files[0];
        if (file && file.type.startsWith('image/')) {
            const imgURL = URL.createObjectURL(file);
            previewImg.src = imgURL;
            previewImg.style.display = 'block';
            previewText.style.display = 'none';
            imageName.textContent = `Selected image: ${file.name}`;
        } else {
            alert('Please select a valid image format.');
        }
    });
</script>
{% endblock %}
